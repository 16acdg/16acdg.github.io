<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading List</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Hind:200,400,500&display=swap" rel="stylesheet">
    <link href="./stylesheets/readinglist.css" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" href="images/favicon.png">
  </head>

  <body>

    <header>
      <h1 id="project-title">Reading List</h1>
      <h2 id="project-subtitle">Some books I'm currently reading and some books I'm reading soon.</h2>
      <div class="show-nav-button" onclick="showNav()"><span id="firstbar">|</span><span id="secondbar">|</span><span id="thirdbar">|</span></div>
      <div id="nav-container" style="left:-200px">
        <a class="site-link" href="https://andrewgray.me#home">Home</a>
        <a class="site-link" href="https://andrewgray.me/resume/AndrewGray.pdf">Resume</a>
        <a class="site-link" href="https://andrewgray.me#projects">Projects</a>
        <!-- <a class="site-link" href="https://andrewgray.me#experience">Experience</a> -->
        <a class="site-link" href="https://andrewgray.me/readinglist.html">Reading List</a>
        <a class="site-link" href="https://andrewgray.me?highlightContact=true">Contact</a>
      </div>
    </header>

    <div id="content-layover">
      <main style="padding-top:1px;">

        <div id="reading-list">
          <h3 style="color:#aaa;margin:50px 0 40px;font-size:25px;" id="loading-books-text">waiting for heroku to wake up...</h3>
        </div>

      <script>
        window.onload = () => {
          // Period animations for loading text when waiting for book data
          let txt = document.getElementById("loading-books-text")
          let counter = 3
          setInterval(() => {
            let postfix = ''
            if (counter == 3) {
              postfix = '...'
            } else if (counter == 2) {
              postfix = '..'
            } else if (counter == 1) {
              postfix = '.'
            }
            counter++
            if (counter == 4) {
              counter = 1
            }
            txt.innerHTML = 'loading books' + postfix
          }, 250)
        }

        // Fetch my reading list data from my microservice supplying read-only data from Goodreads
        const URL = 'https://shielded-wave-89396.herokuapp.com/data'
        fetch(URL).then(res => {
          return res.json()
        }).then(data => {
          console.log(data)
          let completedBooksHTML = ``
          let inprogressBooksHTML = ``
          data.forEach(book => {
            if (book.read) {
              completedBooksHTML += formatBookData(book)
            } else {
              inprogressBooksHTML += formatBookData(book)
            }
          })
          // Inject all html for readinglist page after the data has been fetched
          let html = `
            <br/>
            <br/>
            <h3><b>Already Read</b></h3>
            <br/>
            <div class="book-shelf">
          `
          html += completedBooksHTML
          html += `
            </div>
            <br/>
            <hr style="border: 0.3px solid #bbb;"/>
            <br/>
            <h3><b>Reading Next</b></h3>
            <br/>
            <div class="book-shelf">
          `
          html += inprogressBooksHTML
          html += `
            </div>
          `
          document.getElementById("reading-list").innerHTML = html
        })

        function formatBookData(book) {
          return `
            <div class="book">
              <div class="info-button" onclick="toggleView(this)">
                <p style="color:white;">i</p>
                <div class="hide-summary">${book.description}</div>
              </div>
              <img src="${book.imgSrc[0]}" class="book-cover">
              <h4>${book.title}</h4>
              <h5>${book.author}</h5>
            </div>
          `
        }

        function toggleView(el, bookDescription) {
          if (el.classList.contains('show-info')) {
            el.classList.remove('show-info')
            let bookSummaryTitle = el.childNodes[1]
            let bookSummaryBody = el.childNodes[3]
            bookSummaryTitle.innerHTML = 'i'
            bookSummaryTitle.style.marginTop = '3px'
            bookSummaryBody.classList.remove('show-summary')
            bookSummaryBody.classList.add('hide-summary')
          } else {
            el.classList.add('show-info')
            let bookSummaryTitle = el.childNodes[1]
            let bookSummaryBody = el.childNodes[3]
            bookSummaryTitle.innerHTML = 'Summary:'
            bookSummaryTitle.style.marginTop = '10px'
            bookSummaryTitle.style.marginBottom = '10px'
            bookSummaryBody.classList.remove('hide-summary')
            bookSummaryBody.classList.add('show-summary')
          }
        }
      </script>

      <footer>
        <hr>
        <!-- <hr> -->
        <p style="margin-top:25px;">Hosted on Github Pages</p>
        <p>Inspired by <a href="https://jekyll-theme-minimal-resume.netlify.com/" id="link-to-maurice">Maurice's Jekyll theme</a></p>
        <p style="padding-bottom:35px;">Last updated September 2019</p>
      </footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="javascript/Animations.js" type="text/javascript"></script>

  </body>

</html>
